#Перспективы развития архитектуры операционных систем при использовании контейнерной виртуализации
//на примере Docker

##Введение
Немного про архитектуру ОС (и различие между ними для разных семейств?)  

На сегодняшний день Linux — монолитное ядро с поддержкой загружаемых модулей. Драйверы устройств и расширения ядра обычно запускаются в 0-м кольце защиты, с полным доступом к оборудованию. В отличие от обычных монолитных ядер, драйверы устройств легко собираются в виде модулей и загружаются или выгружаются во время работы системы.  
То, что архитектура Linux не является микроядерной, вызвало обширнейшие прения между Линусом Торвальдсом и Эндрю Таненбаумом в конференции comp.os.minix в 1992 г.  
![Архитектура ядра Linux](https://upload.wikimedia.org/wikipedia/commons/5/5b/Linux_kernel_map.png?uselang=ru)

Архитектура Windows NT имеет модульную структуру и состоит из двух основных уровней — компоненты, работающие в режиме пользователя, и компоненты режима ядра. Программы и подсистемы, работающие в режиме пользователя, имеют ограничения на доступ к системным ресурсам. Режим ядра имеет неограниченный доступ к системной памяти и внешним устройствам. Ядро системы NT называют гибридным ядром или макроядром. Архитектура включает в себя само ядро, уровень аппаратных абстракций (HAL), драйверы и ряд служб (Executives), которые работают в режиме ядра (Kernel-mode drivers) или в пользовательском режиме (User-mode drivers).
![Архитектура ядра Windows](https://upload.wikimedia.org/wikipedia/commons/5/5d/Windows_2000_architecture.svg)



##Основная часть
###Виды виртуализации
####Программная виртуализация
#####Динамическая трансляция
При динамической (бинарной) трансляции проблемные команды гостевой операционной системы перехватываются гипервизором. После того как эти команды заменяются на безопасные, происходит возврат управления гостевой системе.  

#####Паравиртуализация
Паравиртуализация — техника виртуализации, при которой гостевые операционные системы подготавливаются для исполнения в виртуализированной среде, для чего их ядро незначительно модифицируется. Операционная система взаимодействует с программой гипервизора, который предоставляет ей гостевой API, вместо использования напрямую таких ресурсов, как таблица страниц памяти.  
Метод паравиртуализации позволяет добиться более высокой производительности, чем метод динамической трансляции.  
Метод паравиртуализации применим лишь в том случае, если гостевые операционные системы имеют открытые исходные коды, которые можно модифицировать согласно лицензии, или же гипервизор и гостевая операционная система разработаны одним производителем с учётом возможности паравиртуализации гостевой системы (хотя при условии того, что под гипервизором может быть запущен гипервизор более низкого уровня, то и паравиртуализации самого гипервизора).

######Встроенная виртуализация
Преимущества:
* Совместное использование ресурсов несколькими гостевыми операционными системами (каталоги, принтеры и так далее).  
* Удобство интерфейса для окон приложений из разных систем (перекрывающиеся окна приложений, одинаковая минимизация окон, как в хост-системе).  
* При тонкой настройке на аппаратную платформу производительность мало отличается от оригинальной операционной системы. Быстрое переключение между системами (менее одной секунды).  
* Простая процедура обновления гостевой операционной системы.  
* Двухсторонняя виртуализация (приложения одной системы запускаются в другой и наоборот).  

####Аппаратная виртуализация
Преимущества:
* Упрощение разработки программных платформ виртуализации за счет предоставления аппаратных интерфейсов управления и поддержки виртуальных гостевых систем. Это уменьшает трудоемкость и время на разработку систем виртуализации.  
* Возможность увеличения быстродействия платформ виртуализации. Управление виртуальными гостевыми системами осуществляет напрямую небольшой промежуточный слой программного обеспечения, гипервизор, что дает увеличение быстродействия.  
* Улучшается защищённость, появляется возможность переключения между несколькими запущенными независимыми платформами виртуализации на аппаратном уровне. Каждая из виртуальных машин может работать независимо, в своем пространстве аппаратных ресурсов, полностью изолированно друг от друга. Это позволяет устранить потери быстродействия на поддержание хостовой платформы и увеличить защищенность.  
* Гостевая система становится не привязана к архитектуре хостовой платформы и к реализации платформы виртуализации. Технология аппаратной виртуализации делает возможным запуск 64-битных гостевых систем на 32-битных хостовых системах (с 32-битными средами виртуализации на хостах).  


####Виртуализация на уровне операционной системы
Виртуализация на уровне операционной системы позволяет запускать изолированные и безопасные виртуальные машины на одном физическом узле, но не позволяет запускать операционные системы с ядрами, отличными от типа ядра базовой операционной системы. При виртуализации на уровне операционной системы не существует отдельного слоя гипервизора. Вместо этого сама хостовая операционная система отвечает за разделение аппаратных ресурсов между несколькими виртуальными машинами и поддержку их независимости друг от друга.  

###Принципы разделения пространств (namespaces, cgroups)
Не забыть про плюсы и минусы  
####Namespaces
Согласно официальной документации ядра Linux, размещённой на сайте kernel.org,  

    A namespace wraps a global system resource in an abstraction that
    makes it appear to the processes within the namespace that they have
    their own isolated instance of the global resource.  Changes to the
    global resource are visible to other processes that are members of
    the namespace, but are invisible to other processes.  One use of
    namespaces is to implement containers.

    Linux provides the following namespaces:

        Namespace   Constant          Isolates
        Cgroup      CLONE_NEWCGROUP   Cgroup root directory
        IPC         CLONE_NEWIPC      System V IPC, POSIX message queues
        Network     CLONE_NEWNET      Network devices, stacks, ports, etc.
        Mount       CLONE_NEWNS       Mount points
        PID         CLONE_NEWPID      Process IDs
        User        CLONE_NEWUSER     User and group IDs
        UTS         CLONE_NEWUTS      Hostname and NIS domain name

То есть, упрощённо, namespaces позволяют ограничивать видимость некоторых глобальных ресурсов программами. Например, идентификаторов процессов (PID), что позволяет разделять области видимости для процессов, которым не требуется больше: к примеру, некоторый пакетный менеджер не требует для нормальной работы доступа к запущенному веб-браузеру. Но, в случае использования злоумышленником некоторой уязвимости, он мог бы получить к нему доступ.  
####Cgroups
Согласно документации,  

    A cgroup is a collection of processes that are bound to a set of
    limits or parameters defined via the cgroup filesystem.

    A subsystem is a kernel component that modifies the behavior of the
    processes in a cgroup.  Various subsystems have been implemented,
    making it possible to do things such as limiting the amount of CPU
    time and memory available to a cgroup, accounting for the CPU time
    used by a cgroup, and freezing and resuming execution of the
    processes in a cgroup.  Subsystems are sometimes also known as
    resource controllers (or simply, controllers).

    The cgroups for a subsystem are arranged in a hierarchy.  This
    hierarchy is defined by creating, removing, and renaming
    subdirectories within the cgroup filesystem.  At each level of the
    hierarchy, attributes (e.g., limits) can be defined; these attributes
    may govern or propagate to child cgroups and and their descendants in
    the hierarchy.

Таким образом, данная технология позволяет ограничить используемые процессом (или группой процессов) ресурсы вплоть до полной остановки группы (контроллер _freezer_), включая её иерархических "потомков", сообщить приложению меньшее количество оперативной памяти/процессорных ядер процессора, чем на самом деле присутствует в системе, тем самым оставив большее количество ресурсов прочим приложениям, и так далее (см. `man 7 cgroups`, раздел subsystems, для большей информации)

###Принципы контейнерной виртуализации
А-ля "вот вам предыдущая глава, но другими словами"  

###Доступное ПО для управления контейнерами
Docker, Rocket, Vagrant  

###Docker как наиболее известная система управления контейнерами
Docker:container revolution  


####Архитектура, принципы работы Docker
Немного переведённой документации (и каких-то там глав)  

####Поддерживаемое ПО
~~Ж~~**ЁБ**~~В~~**АНАЯ** АМД64!!1  
Возможности сборки докера под i386  

####Docker-hub
Уии, хранилище готовых шестидесятичетырёхбитных слоёв! ^_^  
Как сделать ш386 и ничего не сломать?  

####Документация Docker
Офсайт, StackOverFlow, тонны русскоязычных примеров на сайте, GitHub, <...>  
//прямо список используемой литературы выходит :\  

####Настройки Docker
Хмм.. Каким образом можно запустить контейнеры?  


#####Аргументы командной строки
Хм, а можно ли собрать докер-файл с помощью каких-либо команд, но без докер-файла?  
Какие опции можно опустить при наличии файла?  

#####Docker-файл
Рекомендуемая.. бла-бла-бла.. настройка системы.. бла  

#####чёбыещёвпендюрить


####Разработка Docker
Контрибьют! Открывайте issue на гитхабе, правьте исходники и радуйтесь!  

####Плюсы и минусы
//важная фигня, но, вероятно, и без того выйдет много  
__-__Дыры в ядре, лол.  
__+__Бла-бла-бла, вы всегда можете взять что-то и переместить, бла-бла, контейнеры, бла, отладка-разработка-PaaS?  


##Вывод
//Перспективы применения  
Исходя из описанных выше плюсов и минусов, можно сделать вывод, что контейнерная виртуализация - перспективное направление развития информационных технологий. Оно подходит для решения прикладных задач (например, автоматизации выполнения однотипных действий) и уже может применяться в production-серверах (примеры)  

##Используемая литература
1. [Лекция в рамках Лектория CS центра от 15 апреля 2015 года. "Контейнерная виртуализация в Linux." Кирилл Кринкин: CS центр, СПб АУ РАН, СПбГЭТУ](http://open.compscicenter.ru/archive/virtualization-in-linux/)  
2. [Официальная документация (англ.)](https://docs.docker.com/)  
3. [Установка Docker на 32х-битной системе (англ.)](http://mwhiteley.com/linux-containers/2013/08/31/docker-on-i386.html)  
4. Примеры статей на сайте habrahabr.ru о Docker: [Поняв Docker](https://habrahabr.ru/post/277699/), [Понимая Docker](https://habrahabr.ru/post/253877/)  
5. [Короткое объяснение некоторых принципов работы Docker (англ.)](http://blog.thoward37.me/articles/where-are-docker-images-stored/)  
6. Документация Linux manpages: namespaces(7)